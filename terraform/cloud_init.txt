#cloud-config
package_upgrade: true
runcmd:
  # initialization and update
  - apt update -y >> /var/log/cloud-init-output.log 2>&1

  # Repository logic: installation and repo cloning
  - apt install -y git >> /var/log/cloud-init-output.log 2>&1
  - git clone -b app_development https://github.com/jesusfberrios/automated_cloud_app.git /home/project_user/automated_cloud_app >> /var/log/cloud-init-output.log 2>&1

  # Bash: Grant executable permissions for dependencies installation
  - chown -R project_user:project_user /home/project_user/automated_cloud_app >> /var/log/cloud-init-output.log 2>&1
  - chmod +x /home/project_user/automated_cloud_app/initialization/install_reqs.sh
  - cd /home/project_user/automated_cloud_app/initialization
  - ./install_reqs.sh
  - cd /home/project_user/automated_cloud_app

  # Run Streamlit application on the background
  - nohup streamlit run main/app.py >> log.out &